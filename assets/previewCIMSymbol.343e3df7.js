import{os as x,oz as C,oA as S,ox as v,iJ as I}from"./vendor.96994164.js";import{CIMSymbolRasterizer as D}from"./CIMSymbolRasterizer.7cfff6ba.js";import"./cimAnalyzer.bb4526db.js";import"./CIMSymbolHelper.8308a621.js";import"./BidiEngine.eb17884f.js";import"./enums.c01b5663.js";import"./number.dc47462b.js";const V=new D(null,!0),A=x.maxSize;async function J(e,t={}){const{size:m,maxSize:u,node:y,opacity:h}=t,g=t.cimOptions||t,{feature:w,fieldMap:M,geometryType:b,style:z}=g,f=C(e),d=typeof m=="number"?m:null,i=Math.min(d!=null?d:f,u!=null?u:I(A));i!==f&&(e=e.clone(),S(e,i,{preserveOutlineWidth:!0}));let s=3;e&&e.data&&e.data.symbol&&e.data.symbol.type!=="CIMPointSymbol"&&(s=1);const r=await V.rasterizeCIMSymbolAsync(e,w,M,b,{scaleFactor:s,style:z}),l=document.createElement("canvas");l.width=r.imageData.width,l.height=r.imageData.height,l.getContext("2d").putImageData(r.imageData,0,0);let o=l.width/s,n=l.height/s;if(m!=null&&((t==null?void 0:t.scale)==null||(t==null?void 0:t.scale))){const a=o/n;o=a<=1?Math.ceil(i*a):i,n=a<=1?i:Math.ceil(i/a)}const c=new Image(o,n);c.src=l.toDataURL(),h!=null&&(c.style.opacity=`${h}`);let p=c;if(t.effectView!=null){const a={shape:{type:"image",x:0,y:0,width:o,height:n,src:c.src},fill:null,stroke:null,offset:[0,0]};p=v([[a]],[o,n],{effectView:t.effectView})}return y&&y.appendChild(p),p}export{J as previewCIMSymbol};
