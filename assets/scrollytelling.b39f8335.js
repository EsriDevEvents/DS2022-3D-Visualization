var M=Object.defineProperty;var O=(t,n,e)=>n in t?M(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var o=(t,n,e)=>(O(t,typeof n!="symbol"?n+"":n,e),e);import"./modulepreload-polyfill.b7f2da20.js";/* empty css             *//* empty css               */import{d as b,b as I,f as k,c as q,e as z,U as N,g as J,L as _,N as V,t as $,y as L,k as T,j as H,Z as W,p as U,i as Y,l as x,m as Z}from"./vendor.96994164.js";const K=(t,n,e)=>{let i=n-t;return e&&(i>e/2?i=-i+e:i<-e/2&&(i=i+e)),i},p=(t,n,e,i,r)=>{if(!i)i=1;else if(i===0)throw new Error("Can not interpolate between two values where the distance is 0");const a=K(t,n,r),s=e/i;return t+a*s},S=(t,n,e,i,r)=>{if(t.declaredClass&&t.declaredClass===n.declaredClass){if(t.declaredClass==="esri.Camera"){const a=t,s=n;return new b({heading:p(a.heading,s.heading,e,i,360),position:S(a.position,s.position,e,i),tilt:p(a.tilt,s.tilt,e,i)})}else if(t.declaredClass==="esri.geometry.Point"){const a=t,s=n,c=a.spatialReference;return new I({spatialReference:c,x:p(a.x,s.x,e,i,r),y:p(a.y,s.y,e,i,r),z:p(a.z,s.z,e,i,r)})}}throw new Error("Values a and b do not have compatible types for interpolation")},Q=(t,n,e,i,r)=>{if(t.length===n.length)return t.map((a,s)=>u(a,n[s],e,i,r));throw new Error("Value arrays must have same length for interpolation")},A=t=>t&&Object.prototype.toString.call(t)==="[object Date]"&&!isNaN(t),X=(t,n,e,i)=>{const r=t.getTime(),a=n.getTime();return new Date(p(r,a,e,i))},u=(t,n,e,i,r)=>{const a=typeof t;if(typeof n===a){if(a==="number")return p(t,n,e,i,r);if(a==="object")return Array.isArray(t)&&Array.isArray(n)?Q(t,n,e,i,r):A(t)&&A(n)?X(t,n,e,i):S(t,n,e,i);if(t===void 0)return t}throw new Error("Values a and b do not have compatible types for interpolation")};class ee{constructor(n){o(this,"spatialReference");o(this,"xs",[]);o(this,"dxs",[]);o(this,"points",[]);o(this,"createPolyline",n=>{const e=this.xs,i=e.length,r=i?e[0]:0,a=i?e[i-1]:0,s=r+(a-r)*n,c=this.spatialReference,h=[];if(2<=i){let l=0;for(h.push(this.points[0]);l<e.length-1&&s>e[l+1];)l++,h.push(this.points[l]);const B=this.dxs[l],C=this.points[l],F=this.points[l+1];h.push(u(C,F,s-e[l],B)||[])}return new q({paths:[h],spatialReference:c})});o(this,"newPoint",n=>{const e=n[0],i=n[1],r=n[2];return new I({spatialReference:this.spatialReference,x:e,y:i,z:r})});const e=n.paths.length?n.paths[0]:[];this.spatialReference=n.spatialReference;let i=null;e.forEach((r,a)=>{this.points.push([].concat(r));const s=this.newPoint(r);if(a===0)this.xs.push(0);else{const c=k(i,s,void 0);this.dxs.push(c),this.xs.push(c+this.xs[a-1])}i=s})}}const m="_line_objectid",te=t=>{let n=t.renderer;n&&(n=$(n.toJSON()));let e=t.elevationInfo;e&&typeof e.clone=="function"&&(e=e.clone());const i=[new L({name:"OBJECTID",type:"oid"}),new L({name:m,type:"long"})];return t.fields.forEach(r=>{r.type!=="oid"&&r.name!=="OBJECTID"&&r.name!==m&&i.push(r)}),new V({elevationInfo:e,fields:i,geometryType:"polyline",labelingInfo:t.labelingInfo?t.labelingInfo.map(r=>r.clone()):void 0,labelsVisible:t.labelsVisible,legendEnabled:t.legendEnabled,listMode:t.listMode,maxScale:t.maxScale,minScale:t.maxScale,objectIdField:"OBJECTID",opacity:t.opacity,outFields:["*"],popupEnabled:t.popupEnabled,popupTemplate:t.popupTemplate?t.popupTemplate.clone():void 0,renderer:n,source:[],spatialReference:t.spatialReference,title:t.title})};class ne{constructor(n){o(this,"resolveAnimationLayer",null);o(this,"rejectAnimationLayer",null);o(this,"animationGraphics",new Map);o(this,"sections",new Map);o(this,"animationLayerPromise",z((n,e)=>{this.resolveAnimationLayer=n,this.rejectAnimationLayer=e}));o(this,"seekGraphicDebounce",N((n,e)=>this.seekGraphicSequencial(n,e)));o(this,"queryLineGraphic",n=>{const e=this.sourceLayer;return e?e.queryFeatures({objectIds:[n],outFields:["*"],returnGeometry:!0}).then(i=>{if(i.features.length)return i.features[0];throw new Error("No such graphic with objectId `{objectId}`")}):J("No source layer assigned")});o(this,"getAnimationGraphic",n=>this.animationGraphics.has(n)?_(this.animationGraphics.get(n)):this.queryLineGraphic(n).then(e=>e.clone()).then(e=>{const i=e.attributes[this.sourceLayer.objectIdField];return e.attributes[m]=i,this.animationGraphics.set(n,e),e}));o(this,"initializeAnimationLayer",async()=>{const n=this.sourceLayer;if(await n.load(),n.geometryType!=="polyline"){const i=new Error('`lineLayer` must have `geometryType` "polyline"');throw this.rejectAnimationLayer(i),i}const e=te(n);this.resolveAnimationLayer(e)});this._sourceLayer=n,this.initializeAnimationLayer()}get sourceLayer(){return this._sourceLayer}getLineGraphic(n){const e=n.attributes[m];return this.queryLineGraphic(e)}whenAnimatedLayer(){return this.animationLayerPromise}async seek(n,e){return this.seekGraphicDebounce(n,e)}async seekGraphicSequencial(n,e){const i=await this.getAnimationGraphic(e),r={addFeatures:[],updateFeatures:[]};let a=this.sections.get(e);a?r.updateFeatures=[i]:(a=new ee(i.geometry),this.sections.set(e,a),r.addFeatures=[i]);const s=a.createPolyline(n);return i.geometry=s,this.whenAnimatedLayer().then(c=>{c.applyEdits(r)})}}var ie=document.getElementById("daylightSection"),re=document.getElementById("cameraSection"),ae=document.getElementById("pathSection"),j=new b({position:{spatialReference:T.WebMercator,x:-7909937703683352e-9,y:521441141498922e-8,z:5662.71134893503},heading:0,tilt:0}),R=new Date("Fri Jun 21 2019 19:00:00 GMT+0200"),se=new b({position:{spatialReference:T.WebMercator,x:-7912108151415734e-9,y:521389950879747e-8,z:725.303618597798},heading:74.23167582579066,tilt:43.404465157723436}),oe=new Date("Sat Jun 22 2019 00:45:00 GMT+0200"),d=new H({basemap:"topo-vector",ground:"world-elevation"}),G=new W({url:"https://s3-us-west-2.amazonaws.com/s.cdpn.io/2969649/boston-route.geojson",renderer:new U({symbol:new Y({width:5,color:"orange"})})}),P=new ne(G);P.whenAnimatedLayer().then(function(t){d.add(t)});var y;G.queryObjectIds().then(function(t){y=t[0]});x.fromPortalItem({portalItem:{id:"2d913b3b8caf4f3d87be84ff19d77ac7"}}).then(function(t){d.add(t)});x.fromPortalItem({portalItem:{id:"e1c77e6d3809412f8755faaf810520df"}}).then(function(t){d.add(t)});var g=new Z({container:"viewDiv",qualityProfile:"low",map:d,ui:{components:["attribution"]},camera:j,environment:{lighting:{date:R,directShadowsEnabled:!0}}}),w=0;function f(t){var n=t.getBoundingClientRect(),e=n.top+w,i=window.innerHeight||document.documentElement.clientHeight,r=Math.min(Math.max(i-e,0),n.height);return r/n.height}function ce(){var t=u(j,se,f(re));g.goTo(t,{easing:"linear"}),y&&P.seek(f(ae),y),g.environment.lighting.date=u(R,oe,f(ie))}var E=0,v=!1;function D(){var t=window.pageYOffset||document.documentElement.scrollTop;E=t,w=Math.round(t-E),v=!0,ce(),w?requestAnimationFrame(D):(console.log("Pause animation"),v=!1)}window.onscroll=function(t){v||(console.log("Start animation"),D())};window.view=g;
